---
title: "Historic Car Sales in Canada"
author: "Tim Stephens"
date: "29/03/2021"
output: pdf_document
---

```{r}
###SETUP###
library(tidyverse)
library(here)
library(janitor)


```

```{r}

#read in data
cars <- read_csv(here("inputs/data/newmotorvehiclesales.csv"))


#trim data to what we need
cars_canada <- 
  cars %>% 
  select(When, Vehicle, Canada) %>% 
  mutate(date_when = as.Date(When, format="%m/%d/%Y")) %>% 
  mutate(Year = format(date_when, "%Y"))
  #mutate(Year = substring(When, 9 )) #%>% 
  #mutate(Year_div_10 = (as.integer(substring(When, 9)))/10)

#format(as.Date(df1$Date, format="%Y/%m/%d"),"%Y")
#https://stackoverflow.com/questions/36568070/extract-year-from-date/53340717


#check class
class(cars_canada$date_when)


#testing functions below
cars_canada_test <- 
  cars_canada %>% 
  filter(Year == 2016) %>% 
  filter(Vehicle == "Total, new motor vehicles")

test_trucks <-
  sum(cars_canada_test$Canada)

test_cars <- 
  sum(cars_canada_test$Canada)

test_totals <- 
  sum(cars_canada_test$Canada)


total_totals(2016)



###FUNCTIONS###

# we want to group sales by year. 
total_totals <- 
  function(year, dataset = cars_canada){
    temp_dataset <- 
      dataset %>% 
      filter(Year == year) %>%
      filter(Vehicle == "Total, new motor vehicles") 
    total <- sum(temp_dataset$Canada)
    return(total)
  }

total_trucks <- 
  function(year, dataset = cars_canada){
    temp_dataset <- 
      dataset %>% 
      filter(Year == year) %>%
      filter(Vehicle == "Trucks") 
    total <- sum(temp_dataset$Canada)
    return(total)
  }
    

total_cars <- 
  function(year, dataset = cars_canada){
    temp_dataset <- 
      dataset %>% 
      filter(Year == year) %>%
      filter(Vehicle == "Passenger cars") 
    total <- sum(temp_dataset$Canada)
    return(total)
  }
                      

yearly_vehicle_sales = data.frame()
#run through every year (46 - 15)
  for (i in 1946:2015) {
    x <- total_trucks(i)
    y <- total_cars(i)
    z <- total_totals(i)
    newrow <- data.frame(Year = i, Trucks = x, Cars = y, Total = z)
    yearly_vehicle_sales <- rbind(yearly_vehicle_sales, newrow)
  }

ggplot(yearly_vehicle_sales, aes(x = Year, y = Cars)) +
  theme_minimal() + 
  geom_point()

    
```

```{r}

#spare 

# a = 0/10
# b = format(round(a, digits=1), nsmall = 1) 
# b
# 
# x = 2
# if_else (x < 5, "yes", "no")
# 
#   for (i in 0:9) {
#     number = i/10
#     number_dec = format(round(number, digits=1), nsmall = 1)
#     print(number_dec)
#     if_else (number_dec == cars_canada$Year_div_10, 
#       x <- total_trucks(i)
#       y <- total_cars(i)
#       z <- total_totals(i)
#       newrow <- data.frame(Year = i, Trucks = x, Cars = y, Total = z)
#       yearly_vehicle_sales <- rbind(yearly_vehicle_sales, newrow),
#       yearly_vehicle_sales = yearly_vehicle_sales))
#   }
#   
# 
# #run through every year (46 - 15)
#   for (i in 10:15) {
#     x <- total_trucks(i)
#     y <- total_cars(i)
#     z <- total_totals(i)
#     newrow <- data.frame(Year = i, Trucks = x, Cars = y, Total = z)
#     yearly_vehicle_sales <- rbind(yearly_vehicle_sales, newrow)
#   }
# 


```


Originally, I had a dataset from the Government of Canada with gas prices (USA and Canada)
from 2012-2020. The USA Gov released US gas prices for the time frame that I need (roughly 1950 to 2015).

I was going to use the original dataset to find a relationship between the price 
of Canadian and USA gas to try and determine the Canadian oil prices using the USA dataset. 
However, the relationship had an R2 value below 0.9. So, I am trying to find a dataset of world Oil prices from OPEC that is in the same time frame as my historic car sales. My work is shown below.

```{r}
# get the oil prices 

gas_prices_raw <- read_csv(here("inputs/data/internationalpumppricesall.csv"))
gas_prices_raw

gas_prices <- 
  gas_prices_raw %>% 
  clean_names() %>% 
  select(date, canada,usa_etats_unis_d_amerique, tax_status) %>% 
  filter(tax_status == "Total")

prices <- 
  pivot_longer(gas_prices, 
               cols = c("canada", "usa_etats_unis_d_amerique"),
               names_to = "Country", 
               values_to = "Price")

canada_prices <- 
  prices %>% 
  filter(Country == "canada")


usa_prices <- 
  prices %>% 
  filter(Country == "usa_etats_unis_d_amerique")


canada_plot <- 
  canada_prices %>% 
  ggplot(aes(x = date, y = Price)) + 
  geom_point() + 
  geom_smooth() + 
  theme_minimal()


usa_plot <- 
  usa_prices %>% 
  ggplot(aes(x = date, y = Price)) + 
  geom_point() + 
  geom_smooth() + 
  theme_minimal()

canada_plot
usa_plot


class(gas_prices)

ggplot(gas_prices, aes(x = canada, y = usa_etats_unis_d_amerique)) + 
  geom_point() + 
  geom_smooth(method = lm)

canada_usa <- 
  lm(canada ~ usa_etats_unis_d_amerique, gas_prices)

summary(canada_usa)


#FORMULA -> CDN price = 12.27907 + 1.20195(USD)
```